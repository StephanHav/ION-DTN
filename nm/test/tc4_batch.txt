# Test Set 4: State-Based Rule Production.
#

###############################################################################
# TC 4.1 Generate Reports based on a variable.
###############################################################################
# This test will cause an Agent FULL REPORT to be generated
# up to 5 times whenever Variable V5 == 1.
###############################################################################


#------------------------------------------------------------------------------
# Step 4.1.1: Define UINT V5 = 0.
#------------------------------------------------------------------------------
# V5 ARI = 0xac01410501
#------------------------------------------------------------------------------
c11541005585054324261145ac01410501464514814243004114


#------------------------------------------------------------------------------
# Step 4.1.2: Retrieve value of V5 in a report.
#------------------------------------------------------------------------------
c11541054f8405422523478145ac014105014180


#------------------------------------------------------------------------------
# Step 4.1.3: Confirm value of V5 is 0.
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.4: Define Macro M1 generate an agent FULL_REPORT and reset V5 = 0
#------------------------------------------------------------------------------
# Macro = [genRpt([FULL_REPORT], 0), Store(V5, 0)]
# M1 ARI = 0xa401410501
#------------------------------------------------------------------------------
c115410758418505431224254463746d7045a401410501582e8254c11541054f84054225234781458718194100418057c115410e52840542242645ac0141050146451481424300

#------------------------------------------------------------------------------
# Step 4.1.5: List Macros 
#------------------------------------------------------------------------------
c11541064f84054225234781458a181b41034180

#------------------------------------------------------------------------------
# Step 4.1.6: Review returned report and make sure MACRO M1 is listed.
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.7: Describe Macro M1
#------------------------------------------------------------------------------
c11541094c83054125478145a401410501

#------------------------------------------------------------------------------
# Step 4.1.8: Make sure M1 was described correctly.
#------------------------------------------------------------------------------



#------------------------------------------------------------------------------
# Step 4.1.7: Define SRL S1 to run every time V5 >= 2 up to 3 times. 
#------------------------------------------------------------------------------
# A1 ARI = 0xa801410101
# Start = 0
# Expr = [V5, 0, ==]
# Count = 3
# Action = [M1]
#------------------------------------------------------------------------------
c115410b583788054624162616251245a80141010141005554148345ac0141050142430048c5181842183141804103478145a401410501456464657363

#------------------------------------------------------------------------------
# Step 4.1.8: List known SRLs 
#------------------------------------------------------------------------------
c11541064f84054225234781458a181b41044180


#------------------------------------------------------------------------------
# Step 4.1.9: Ensure that SRL1 is there.
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.10: Describe SRL1
#------------------------------------------------------------------------------
c115410d4c83054125478145a801410101


#------------------------------------------------------------------------------
# Step 4.1.11: Ensure that SRL1 matches description
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.12: Set TRL rule to run every 20 seconds 6 times that will
# run the command: C4 = C4 + 1 which is: STOR(C4, {(UINT), C4 1 +})
#------------------------------------------------------------------------------
# NOTE: C4 MID is 110103030201
# NOTE: TRL ID will be 1501020101
#------------------------------------------------------------------------------
c304010e060514101010150515010201010100011401062601c30401160302141606110103030201150b03110103030201c7050102020110010188070100

#------------------------------------------------------------------------------
# Step 4.1.13: Verify SRL1 runs 3 times, approximately every 40 seconds.
#------------------------------------------------------------------------------

WAIT 170

#------------------------------------------------------------------------------
# Step 4.1.14: Inspect ADM reports for correct # TRL and SRL
# counts.
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.15: List known SRLs
#------------------------------------------------------------------------------
83040114

#------------------------------------------------------------------------------
# Step 4.1.16: Verify SRL1 is no longer listed 
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.17: Delete SRL 1. i.e. show no issue with deleting a deleted SRL
#------------------------------------------------------------------------------
c30401130201150701140103090807

#------------------------------------------------------------------------------
# Step 4.1.18: List Known SRLs
#------------------------------------------------------------------------------
83040114

#------------------------------------------------------------------------------
# Step 4.1.19: Verify SRL1 no longer listed.
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Step 4.1.20: Restart Agent and verify only 1 CD and 1 Macro restore.
# OPTIONAL
#------------------------------------------------------------------------------

